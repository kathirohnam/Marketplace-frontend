<div class="category-page">
  <!-- Header -->
  <header class="site-header">
    <div class="container">
      <div class="header-row">
        <div class="brand-side">
          <button (click)="onBack()" class="back-button" aria-label="Back to Directory">
            <svg class="icon-16" viewBox="0 0 24 24" fill="none">
              <path stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    d="M15 19l-7-7 7-7"></path>
            </svg>
            <span>Back to Directory</span>
          </button>

          <div class="divider-vertical"></div>

          <div class="brand">
            <div class="brand-mark">B</div>
            <h1 class="brand-name">BusinessHub</h1>
          </div>
        </div>

        <div class="header-cta">
          <button (click)="onJoinNow()" class="btn-primary">Join Now</button>
        </div>
      </div>
    </div>
  </header>

  <!-- Search Bar (NEW: compact & centered) -->
  <section class="search-bar">
    <div class="container">
      <div class="search-shell">
        <div class="search-field">
          <svg class="search-icon icon-16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>

          <input
            type="text"
            class="search-input"
            placeholder="Search businesses, services, or keywords..."
            [value]="searchQuery()"
            (input)="onSearchInput($event)" />

          <button (click)="onSearch()" class="search-cta">Search</button>
        </div>

        <!-- optional hint -->
        <p class="search-hint">Tip: Try “bookkeeping”, “strategy consulting”, or a ZIP code.</p>
      </div>
    </div>
  </section>

  <main class="container page-body">
    <!-- Breadcrumb -->
    <nav class="breadcrumb" aria-label="Breadcrumb">
      <button class="breadcrumb-link">Home</button>
      <svg class="breadcrumb-sep icon-16" viewBox="0 0 24 24" fill="none">
        <path stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
              d="M9 5l7 7-7 7"></path>
      </svg>
      <button class="breadcrumb-link">{{ category() }}</button>
      <svg class="breadcrumb-sep icon-16" viewBox="0 0 24 24" fill="none">
        <path stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
              d="M9 5l7 7-7 7"></path>
      </svg>
      <span class="breadcrumb-current">Business Support Services</span>
    </nav>

    <!-- Page Header -->
    <div class="page-header">
      <div class="page-heading">
        <h2 class="page-title">Business Support Services</h2>

        <div class="page-stats">
          <div class="stat">
            <svg class="icon-16" viewBox="0 0 24 24" fill="none">
              <path stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
            </svg>
            <span>Found {{ filteredBusinesses().length }} businesses</span>
          </div>

          <div class="stat">
            <svg class="icon-16" viewBox="0 0 24 24" fill="none">
              <path stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <span>Chamber verified</span>
          </div>
        </div>
      </div>

      <!-- Ratings Filter -->
      <div class="rating-filter">
        <button (click)="ratingMenuOpen.set(!ratingMenuOpen())" class="rating-button" aria-haspopup="listbox">
          <span>{{ ratingLabel() }}</span>
          <svg class="icon-16 chevron" viewBox="0 0 24 24" fill="none">
            <path stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                  d="M19 9l-7 7-7-7"></path>
          </svg>
        </button>

        <div *ngIf="ratingMenuOpen()" class="rating-menu" role="listbox">
          <button (click)="setRatingFilter('all')" class="menu-item">All Ratings</button>
          <button (click)="setRatingFilter('4.5')" class="menu-item">4.5+</button>
          <button (click)="setRatingFilter('4.0')" class="menu-item">4.0+</button>
          <button (click)="setRatingFilter('3.5')" class="menu-item">3.5+</button>
        </div>
      </div>
    </div>

    <!-- Business Listings -->
    <section class="business-list">
      <article *ngFor="let business of filteredBusinesses(); let i = index" class="business-card">
        <div class="card-body">
          <div class="card-grid">
            <div class="avatar">
              <img [src]="business.image" [alt]="business.name" class="avatar-img" />
            </div>

            <div class="card-main">
              <div class="card-top">
                <div class="name-and-verify">
                  <h3 class="biz-name">{{ business.name }}</h3>
                  <div *ngIf="business.verified" class="verify-badge" aria-label="Verified">
                    <span class="verify-dot"></span>
                  </div>
                </div>
              </div>

              <div class="rating-row">
                <div class="stars">
                  <ng-container *ngFor="let star of getStarsArray(business.rating); let j = index">
                    <svg *ngIf="star === 1" class="star star-filled" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                    <svg *ngIf="star === 0" class="star star-empty" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                  </ng-container>
                </div>
                <span class="rating-text">({{ business.rating }})</span>
                <span class="review-count">{{ business.reviewCount }} reviews</span>
              </div>

              <p class="desc">{{ business.description }}</p>

              <div class="contact-row">
                <div class="contact">
                  <svg class="icon-16" viewBox="0 0 24 24" fill="none">
                    <path stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                          d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                    <path stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                          d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  </svg>
                  <span>{{ getShortAddress(business.address) }}</span>
                </div>
                <div class="contact">
                  <svg class="icon-16" viewBox="0 0 24 24" fill="none">
                    <path stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                          d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                  </svg>
                  <span>{{ business.phone }}</span>
                </div>
              </div>

              <div class="card-bottom">
                <div class="tags">
                  <span *ngFor="let tag of business.tags.slice(0, 3)" class="tag">{{ tag }}</span>
                </div>
                <button (click)="onBusinessDetail(business.id)" class="btn-outline">
                  View Details
                </button>
              </div>
            </div>
          </div>
        </div>
      </article>
    </section>
  </main>
</div>
