<mat-card class="cardWithShadow">
  <mat-card-content>
    <h2 class="form-header">
      {{ editMode ? "Edit User Account" : "Add New User Account" }}
    </h2>

    <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
      <!-- Role Selection -->
      <mat-form-field appearance="outline" class="w-100 mb-4">
        <mat-label>Role</mat-label>
        <mat-select formControlName="role">
          <mat-option value="SuperFiler">SuperFiler</mat-option>
          <mat-option value="Vendor">Vendor</mat-option>
        </mat-select>
        <mat-error *ngIf="userForm.get('role')?.hasError('required')"
          >Role is required</mat-error
        >
      </mat-form-field>
      <!-- Shared Contact Info -->
      <app-user-contact-info [formGroup]="userForm"></app-user-contact-info>
      <!-- Vendor Specific Fields -->
      <div *ngIf="isVendor" class="vendor-fields">
        <h3 class="sub-header mb-3">Vendor Details</h3>

        <!-- EIN -->
        <div class="row">
          <div class="col">
            <mat-form-field
              appearance="outline"
              class="w-100 mb-4"
              *ngIf="isVendor"
            >
              <mat-label>EIN</mat-label>
              <input
                matInput
                formControlName="ein"
                placeholder="12-3456789"
                mask="00-0000000"
                [dropSpecialCharacters]="false"
                required
                pattern="^[0-9]{2}-[0-9]{7}$"
              />
              <mat-error *ngIf="userForm.get('ein')?.hasError('required')">
                EIN is required
              </mat-error>
              <mat-error *ngIf="userForm.get('ein')?.hasError('pattern')">
                Invalid EIN (format XX-XXXXXXX)
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <!-- Vendor Name -->
        <div class="row">
          <div class="col">
            <mat-form-field appearance="outline" class="w-100 mb-4">
              <mat-label>Vendor Name</mat-label>
              <input
                matInput
                formControlName="vendorName"
                placeholder="Enter vendor name"
                maxlength="60"
                required
                
              />
              <mat-error
                *ngIf="userForm.get('vendorName')?.hasError('required')"
                >Vendor name is required</mat-error
              >
              <mat-error
                *ngIf="userForm.get('vendorName')?.hasError('pattern')"
              >
                Use only letters
              </mat-error>
               <mat-error
                          *ngIf="
                            userForm.get('vendorName')?.hasError('maxlength')
                          "
                        >
                          Max 60 characters allowed
                        </mat-error>
            </mat-form-field>
          </div>
          <!-- Alternative Name -->
          <div class="col">
            <mat-form-field appearance="outline" class="w-100 mb-4">
              <mat-label>Alternative Name</mat-label>
              <input
                matInput
                formControlName="alternativeName"
                placeholder="Enter alternative name"
                maxlength="60"
              />
               <mat-error
                          *ngIf="
                            userForm.get('alternativeName')?.hasError('maxlength')
                          "
                        >
                          Max 60 characters allowed
                        </mat-error>
            </mat-form-field>
          </div>
        </div>

        <!-- Vendor Contact Number -->
        <div class="row">
          <div class="col">
            <mat-form-field appearance="outline" class="w-100 mb-4">
              <mat-label>Contact Number</mat-label>
              <input
                matInput
                type="text"
                formControlName="vendorContactNumber"
                placeholder="(123) 456-7890"
                mask="(000) 000-0000"
                [dropSpecialCharacters]="false"
                
              />
              <!-- Required Error -->
              <mat-error
                *ngIf="
                  userForm.get('vendorContactNumber')?.hasError('required')
                "
              >
                Contact number is required
              </mat-error>

              <!-- Pattern Error -->
              <mat-error
                *ngIf="userForm.get('vendorContactNumber')?.hasError('pattern')"
              >
                Use format (123) 456-7890
              </mat-error>
            </mat-form-field>
          </div>
          <!-- Website -->
          <div class="col">
            <mat-form-field
              appearance="outline"
              class="w-100 mb-4"
              *ngIf="isVendor"
            >
              <mat-label>Vendor Email</mat-label>
              <input
                matInput
                formControlName="vendor_email"
                placeholder="vendor@example.com"
                required
                type="email"
                
              />
              <mat-error
                *ngIf="userForm.get('vendor_email')?.hasError('required')"
              >
                Email is required
              </mat-error>
              <mat-error
                *ngIf="
                  userForm.get('vendor_email')?.hasError('pattern') &&
                  !userForm.get('vendor_email')?.hasError('required')
                "
              >
                Please enter a valid email address
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <h3 class="sub-header mb-3">Address Information</h3>

        <!-- Address -->
        <div class="row">
          <div class="col">
            <mat-form-field appearance="outline" class="w-100 mb-4">
              <mat-label>Address</mat-label>
              <input
                matInput
                formControlName="address"
                placeholder="Enter address"
                required
                
              />
              <mat-error *ngIf="userForm.get('address')?.hasError('required')"
                >Address is required</mat-error
              >
              <mat-error *ngIf="userForm.get('address')?.hasError('pattern')"
                >Invalid Address</mat-error
              >
              <mat-error *ngIf="userForm.get('address')?.hasError('minlength')"
                > Address must be at least 5 characters</mat-error
              >
              
            </mat-form-field>
          </div>
          <!-- City -->
          <div class="col">
            <mat-form-field appearance="outline" class="w-100 mb-4">
              <mat-label>City</mat-label>
              <input
                matInput
                formControlName="city"
                placeholder="Enter city"
                
                required
              />
              <mat-error *ngIf="userForm.get('city')?.hasError('required')"
                >City is required</mat-error
              >
              <mat-error *ngIf="userForm.get('city')?.hasError('pattern')"
                >Only letters allowed</mat-error
              >
              <mat-error
                      *ngIf="
                        userForm.get('city')?.hasError('minlength')
                      "
                    >
                      City must be at least 5 characters
                    </mat-error>
            </mat-form-field>
          </div>
        </div>

        <!-- State, Country, ZIP -->
        <div class="row">
          <div class="col">
            <mat-form-field appearance="outline" class="w-100 mb-4">
              <mat-label>State</mat-label>
              <input
                matInput
                formControlName="state"
                placeholder="Enter state"
                required
                maxlength="2"
                
              />
              <mat-error *ngIf="userForm.get('state')?.hasError('required')"
                >State is required</mat-error
              >
              <mat-error *ngIf="userForm.get('state')?.hasError('maxlength')"
                >State code must be 2 characters</mat-error
              >
              <mat-error *ngIf="userForm.get('state')?.hasError('pattern')"
                >Invalid state code</mat-error
              >
            </mat-form-field>
          </div>
          <div class="col">
            <!-- Country -->
            <mat-form-field appearance="outline" class="w-100 mb-4">
              <mat-label>Country</mat-label>
              <input
                matInput
                formControlName="country"
                placeholder="Enter country"
                required
                
              />

              <!-- Required Error -->
              <mat-error *ngIf="userForm.get('country')?.hasError('required')">
                Country is required
              </mat-error>

              <!-- Pattern Error (always live while typing) -->
              <mat-error
                *ngIf="
                  userForm.get('country')?.hasError('pattern') &&
                  userForm.get('country')?.invalid
                "
              >
                Use only letters
              </mat-error>
              <mat-error
                      *ngIf="
                        userForm.get('country')?.hasError('minlength')
                      "
                    >
                      Country must be at least 5 characters
                    </mat-error>
            </mat-form-field>
          </div>
          <div class="col">
            <mat-form-field appearance="outline" class="w-100 mb-4">
              <mat-label>ZIP</mat-label>
              <input
                matInput
                formControlName="zip"
                placeholder="Enter ZIP code"
                mask="00000"
                [dropSpecialCharacters]="false"
                required
                pattern="^[0-9]{5}$"
                
              />
              <mat-error *ngIf="userForm.get('zip')?.hasError('pattern')"
                >Invalid Zipcode format</mat-error
              >
            </mat-form-field>
          </div>
        </div>
      </div>
      <!-- File Upload for Both SuperFiler and Vendor -->
      <div *ngIf="isSuperFilerOrVendor">
        <h3 class="sub-header mb-3">Profile Image Upload</h3>
        <app-profile-upload></app-profile-upload>
      </div>

      <div class="d-flex justify-content-end align-items-center gap-16 mt-4">
        <button
          mat-button
          type="button-prev"
          class="button-prev"
          (click)="navigateToAdminList()"
        >
          Cancel
        </button>
        <button
          mat-flat-button
          class="button-all"
          type="submit"
          [disabled]="userForm.invalid"
        >
          {{ editMode ? "Update User" : "Add User" }}
        </button>
      </div>
    </form>
  </mat-card-content>
</mat-card>
